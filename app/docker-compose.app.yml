services:
  nova-app-frontend:
    environment:
      - NODE_ENV=${NODE_ENV}
      - PORT=${FRONTEND_PORT}
      - PROXY_ENDPOINT=${PROXY_ENDPOINT}
      - PROXY_API_KEY=${PROXY_API_KEY}
      - MEDIA_ENDPOINT=${MEDIA_ENDPOINT}
      - AUTHOR_NAME=${AUTHOR_NAME}
      - AUTHOR_PROFILE=${AUTHOR_PROFILE}
      - NEXT_PUBLIC_FETCH_COUNT=${NEXT_PUBLIC_FETCH_COUNT}
      - NEXT_PUBLIC_SOCKET_HOSTNAME=${NEXT_PUBLIC_SOCKET_HOSTNAME}
      - NEXT_PUBLIC_SOCKET_PORT=${NEXT_PUBLIC_SOCKET_PORT}
      - NEXT_PUBLIC_SOCKET_PATH=${NEXT_PUBLIC_SOCKET_PATH}
      - NEXT_PUBLIC_SOCKET_SECURE=${NEXT_PUBLIC_SOCKET_SECURE}

    image: ${DOCKER_USERNAME}/nova-app-frontend:latest
    container_name: nova-app-frontend
    restart: unless-stopped

    ports:
      - '${FRONTEND_PORT}:3003'

    networks:
      - app-network

    depends_on:
      - nova-app-backend

  nova-app-backend:
    environment:
      - NODE_ENV=${NODE_ENV}
      - APP_PORT=${BACKEND_PORT}
      - API_KEY=${API_KEY}
      - MONGODB_URI=${MONGODB_URI}
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      - REDIS_URI=${REDIS_URI}
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRES_IN=${JWT_EXPIRES_IN}
      - JWT_REFRESH_SECRET=${JWT_REFRESH_SECRET}
      - JWT_REFRESH_EXPIRES_IN=${JWT_REFRESH_EXPIRES_IN}
      - THROTTLE_TTL=${THROTTLE_TTL}
      - THROTTLE_LIMIT=${THROTTLE_LIMIT}

    image: ${DOCKER_USERNAME}/nova-app-backend:latest
    container_name: nova-app-backend
    restart: unless-stopped

    ports:
      - '${BACKEND_PORT}:4000'

    volumes:
      - ./nestjs_logs:/app/logs

    networks:
      - app-network

networks:
  app-network:
    driver: bridge
